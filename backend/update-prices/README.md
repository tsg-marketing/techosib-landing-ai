# Функция обновления цен из XML-фида

## Описание
Бэкенд-функция для автоматического парсинга XML-фида с t-sib.ru и извлечения актуальных цен на паллетообмотчики.

## URL функции
```
https://functions.poehali.dev/c5dcf94d-754c-4745-b50e-37b437be727a
```

## Соответствие моделей и offer_id в фиде

| Модель | Offer ID | Название в фиде |
|--------|----------|-----------------|
| TS3000MR-H | 6323 | Полуавтоматический паллетообмотчик TS3000MR-H |
| TS3000SPS-H | 6324 | Полуавтоматический паллетообмотчик TS3000SPS-H |
| TS3000MR-TP | 6325 | Полуавтоматический паллетообмотчик TS3000MR-TP |
| TS3000SPS-TP | 6326 | Полуавтоматический паллетообмотчик TS3000SPS-TP |
| TS3000MR-MT | 6327 | Полуавтоматический паллетообмотчик TS3000MR-MT |
| TS3000SPS-MT | 6328 | Полуавтоматический паллетообмотчик TS3000SPS-MT |
| TS3000MR-MT-TP | 6329 | Полуавтоматический паллетообмотчик TS3000MR-MT-TP |
| TS3000SPS-MT-TP | 6330 | Полуавтоматический паллетообмотчик TS3000SPS-MT-TP |

## Формат ответа

```json
{
  "success": true,
  "prices": {
    "TS3000MR-H": {
      "price": "310 392",
      "price_raw": 310392,
      "offer_id": "6323",
      "name": "Полуавтоматический паллетообмотчик TS3000MR-H"
    }
  },
  "min_price": "310 392",
  "min_price_raw": 310392,
  "updated_at": "request_id",
  "models_found": 2
}
```

## Использование на фронтенде

Функция автоматически вызывается через хук `usePrices()` в `src/hooks/usePrices.ts`:

- **Кэширование**: Цены кэшируются в localStorage на 24 часа
- **Автообновление**: При первой загрузке страницы или по истечении 24 часов
- **Fallback**: Если API недоступен, используются статические цены из models массива

## Где используются цены

1. **Главный баннер** - минимальная цена "От X руб"
2. **Карточки моделей** - индивидуальные цены для каждой модели
3. **Сравнительная таблица** - цены всех моделей в таблице
4. **Результаты квиза** - цена рекомендованной модели

## Обновление offer_id

Если в XML-фиде изменятся offer_id для моделей, обновите маппинг в `backend/update-prices/index.py`:

```python
model_mapping = {
    '6323': 'TS3000MR-H',
    '6324': 'TS3000SPS-H',
    # ...
}
```

После изменений запустите `sync_backend` для деплоя новой версии.
